<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Document Analyzer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Set Inter font -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        spin: 'spin 1s linear infinite',
                    },
                    keyframes: {
                        spin: {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' },
                        },
                    }
                },
            },
        };
    </script>
    <style>
        /* Basic styling for the app */
        body {
            font-family: 'Inter', sans-serif;
            /* Prevent overscroll on mobile */
            overflow-x: hidden;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568; /* gray-600 */
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* gray-500 */
        }

        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3b82f6; /* blue-500 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        /* Hide content panel by default */
        .tab-content {
            display: none;
        }
        /* Show active content panel */
        .tab-content.active {
            display: block;
        }

        /* Ensure layout is scrollable on mobile */
        main {
            min-height: 0;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-white flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mr-3 text-blue-400"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                AI Document Analyzer
            </h1>
            <p class="text-base md:text-lg text-gray-400 mt-1">Upload a file or paste text below to get a complete AI-powered analysis.</p>
        </header>

        <!-- Main Content: 2-column layout -->
        <!-- Added overflow-hidden to parent for better layout control -->
        <main class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 overflow-hidden">
            
            <!-- Left Column: Input -->
            <!-- Changed height to be flexible on mobile and fixed on desktop -->
            <div class="flex flex-col gap-4 h-[70vh] md:h-[calc(100vh-170px)]">
                
                <!-- File Upload Area -->
                <div class="flex-shrink-0">
                    <label for="fileUpload" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition-colors duration-200 flex items-center justify-center gap-2 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        Upload File (.pdf, .docx)
                    </label>
                    <input type="file" id="fileUpload" class="hidden" accept=".pdf,.docx">
                    <p id="fileName" class="text-gray-400 text-sm mt-2 ml-1 truncate"></p>
                </div>

                <textarea id="inputText" 
                    class="w-full flex-grow bg-gray-800 border border-gray-700 rounded-lg p-4 text-gray-200 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                    placeholder="...or paste your document text here..."
                ></textarea>
                
                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-4 flex-shrink-0">
                    <button id="analyzeButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition-colors duration-200 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        Analyze Text
                    </button>
                    <button id="summarizeButton" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md transition-colors duration-200 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg>
                        Summarize
                    </button>
                </div>
            </div>

            <!-- Right Column: Output -->
            <!-- Changed height to be flexible on mobile and fixed on desktop -->
            <div class="flex flex-col h-[70vh] md:h-[calc(100vh-170px)]">
                <!-- Tab Buttons -->
                <nav class="flex border-b border-gray-700 flex-shrink-0">
                    <!-- Added overflow-x-auto for small screens -->
                    <div class="flex overflow-x-auto">
                        <button class="tab-button active flex-shrink-0 py-3 px-4 text-center font-medium text-blue-400 border-b-2 border-blue-400" data-tab="analysis">Analysis</button>
                        <button class="tab-button flex-shrink-0 py-3 px-4 text-center font-medium text-gray-400 hover:text-gray-200" data-tab="summary">Summary</button>
                        <button class="tab-button flex-shrink-0 py-3 px-4 text-center font-medium text-gray-400 hover:text-gray-200" data-tab="qa">Q&A</button>
                        <button class="tab-button flex-shrink-0 py-3 px-4 text-center font-medium text-gray-400 hover:text-gray-200" data-tab="generate">Generate</button>
                    </div>
                </nav>

                <!-- Tab Content Panels -->
                <div class="flex-grow bg-gray-800 rounded-b-lg overflow-y-auto p-6">
                    
                    <!-- Analysis Panel -->
                    <div id="analysis" class="tab-content active">
                        <div id="analysisLoader" class="hidden items-center justify-center h-48"><div class="loader"></div></div>
                        <div id="analysisContent">
                            <h2 class="text-2xl font-semibold mb-4 text-white">Analysis Results</h2>
                            <!-- Stats grid: 2 cols on mobile, 4 on desktop -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-gray-700 p-4 rounded-lg text-center">
                                    <div class="text-sm text-gray-400 uppercase">Word Count</div>
                                    <div id="wordCount" class="text-3xl font-bold text-white">-</div>
                                </div>
                                <div class="bg-gray-700 p-4 rounded-lg text-center">
                                    <div class="text-sm text-gray-400 uppercase">Sentences</div>
                                    <div id="sentenceCount" class="text-3xl font-bold text-white">-</div>
                                </div>
                                <div class="bg-gray-700 p-4 rounded-lg text-center">
                                    <div class="text-sm text-gray-400 uppercase">Characters</div>
                                    <div id="charCount" class="text-3xl font-bold text-white">-</div>
                                </div>
                                <div class="bg-gray-700 p-4 rounded-lg text-center">
                                    <div class="text-sm text-gray-400 uppercase">Sentiment</div>
                                    <div id="sentimentLabel" class="text-3xl font-bold text-white">-</div>
                                </div>
                            </div>
                            
                            <!-- Analysis grid: 1 col on mobile, 2 on desktop -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-xl font-semibold mb-3 text-white">Keywords</h3>
                                    <div id="keywordsList" class="flex flex-wrap gap-2">
                                        <p class="text-gray-400">Run analysis to see keywords.</p>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-semibold mb-3 text-white">Named Entities (NER)</h3>
                                    <div id="nerList" class="flex flex-col gap-2">
                                        <p class="text-gray-400">Run analysis to see entities.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Panel -->
                    <div id="summary" class="tab-content">
                        <h2 class="text-2xl font-semibold mb-4 text-white">Summary</h2>
                        <div id="summaryLoader" class="hidden items-center justify-center h-48"><div class="loader"></div></div>
                        <div id="summaryContent" class="text-gray-300 whitespace-pre-wrap leading-relaxed">
                            <p class="text-gray-400">Click "Summarize" to generate a summary.</p>
                        </div>
                    </div>

                    <!-- Q&A Panel -->
                    <div id="qa" class="tab-content">
                        <h2 class="text-2xl font-semibold mb-4 text-white">Ask a Question</h2>
                        <p class="text-gray-400 mb-4">Ask a question based on the document you provided.</p>
                        <div class="flex flex-col sm:flex-row gap-2 mb-4">
                            <input type="text" id="questionInput" class="flex-grow bg-gray-700 border border-gray-600 rounded-lg p-3 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., What was the main conclusion?">
                            <button id="askButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-5 rounded-lg shadow-md transition-colors duration-200 flex-shrink-0">Ask</button>
                        </div>
                        <div id="qaLoader" class="hidden items-center justify-center h-32"><div class="loader"></div></div>
                        <div id="qaContent" class="bg-gray-900 p-4 rounded-lg min-h-[100px]">
                            <p class="text-gray-400">Your answer will appear here.</p>
                        </div>
                    </div>

                    <!-- Generate Panel -->
                    <div id="generate" class="tab-content">
                        <h2 class="text-2xl font-semibold mb-4 text-white">Generate Content</h2>
                        <p class="text-gray-400 mb-4">Use AI to generate new content based on your document.</p>
                        <button id="replyButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-5 rounded-lg shadow-md transition-colors duration-200 mb-4">
                            Draft a Reply
                        </button>
                        <div id="generateLoader" class="hidden items-center justify-center h-32"><div class="loader"></div></div>
                        <textarea id="generateContent" class="w-full h-64 bg-gray-900 border border-gray-700 rounded-lg p-4 text-gray-200 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Generated content will appear here..."></textarea>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-md">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-bold text-red-400">Error</h3>
                <button id="closeErrorModal" class="text-gray-400 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <p id="errorMessage" class="text-gray-200">An unknown error occurred.</p>
        </div>
    </div>

    <!-- Processing Modal -->
    <div id="processingModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-8 w-full max-w-md flex flex-col items-center">
            <div class="loader mb-4"></div>
            <h3 class="text-2xl font-bold text-white">Processing File...</h3>
            <p class="text-gray-300">Please wait while the document is being analyzed.</p>
        </div>
    </div>


    <!-- ================================== -->
    <!--          JAVASCRIPT                -->
    <!-- ================================== -->
    <script>
        window.addEventListener('load', () => {
            
            // Get all interactive elements
            const inputText = document.getElementById('inputText');
            const analyzeButton = document.getElementById('analyzeButton');
            const summarizeButton = document.getElementById('summarizeButton');
            const askButton = document.getElementById('askButton');
            const replyButton = document.getElementById('replyButton');
            const questionInput = document.getElementById('questionInput');
            
            // New file upload elements
            const fileUpload = document.getElementById('fileUpload');
            const fileName = document.getElementById('fileName');
            const processingModal = document.getElementById('processingModal');

            const errorModal = document.getElementById('errorModal');
            const errorMessage = document.getElementById('errorMessage');
            const closeErrorModal = document.getElementById('closeErrorModal');

            const tabButtons = document.querySelectorAll('.tab-button');

            const API_BASE_URL = 'http://127.0.0.1:5000';

            // --- Helper Functions ---

            function showError(message) {
                console.error(message);
                if (errorMessage) errorMessage.textContent = message;
                if (errorModal) errorModal.classList.remove('hidden');
            }
            
            function showProcessingModal() {
                if (processingModal) processingModal.classList.remove('hidden');
            }

            function hideProcessingModal() {
                if (processingModal) processingModal.classList.add('hidden');
            }

            function showLoader(loaderId, contentId) {
                const loader = document.getElementById(loaderId);
                const content = document.getElementById(contentId);
                if (loader) {
                    loader.style.display = 'flex';
                    loader.classList.remove('hidden');
                }
                if (content) content.classList.add('hidden');
            }

            function hideLoader(loaderId, contentId) {
                const loader = document.getElementById(loaderId);
                const content = document.getElementById(contentId);
                if (loader) {
                    loader.style.display = 'none';
                    loader.classList.add('hidden');
                }
                if (content) content.classList.remove('hidden');
            }

            function getText() {
                const text = inputText.value.trim();
                if (!text) {
                    showError('Please paste text or upload a file first.');
                    return null;
                }
                return text;
            }

            function switchTab(tabId) {
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.classList.remove('active', 'text-blue-400', 'border-blue-400');
                    button.classList.add('text-gray-400');
                });
                
                const activeContent = document.getElementById(tabId);
                if (activeContent) activeContent.classList.add('active');
                
                const activeButton = document.querySelector(`.tab-button[data-tab="${tabId}"]`);
                if (activeButton) {
                    activeButton.classList.add('active', 'text-blue-400', 'border-blue-400');
                    activeButton.classList.remove('text-gray-400');
                }
            }

            // --- API Call Functions ---

            /**
             * NEW: Handle File Upload
             */
            async function handleFileUpload() {
                const file = fileUpload.files[0];
                if (!file) return;

                // Check file type
                const allowedTypes = ['.pdf', '.docx'];
                const fileType = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
                if (!allowedTypes.includes(fileType)) {
                    showError('Invalid file type. Please upload a .pdf or .docx file.');
                    fileUpload.value = ''; // Reset file input
                    return;
                }
                
                fileName.textContent = file.name;
                showProcessingModal();

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch(`${API_BASE_URL}/upload`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    inputText.value = data.text; // Populate textarea
                    
                    // Automatically run analysis after successful upload
                    handleAnalyze();

                } catch (error) {
                    showError(`Failed to upload file: ${error.message}`);
                    fileName.textContent = '';
                    inputText.value = '';
                } finally {
                    hideProcessingModal();
                    fileUpload.value = ''; // Reset file input
                }
            }

            /**
             * 1. Handle Full Analysis
             */
            async function handleAnalyze() {
                const text = getText();
                if (!text) return;

                switchTab('analysis');
                showLoader('analysisLoader', 'analysisContent');
                
                // Simple stats (run immediately)
                const wordCount = text.split(/\s+/).filter(Boolean).length;
                const sentenceCount = (text.match(/[.!?\n]+/g) || []).length || 1;
                const charCount = text.length;

                document.getElementById('wordCount').textContent = wordCount;
                document.getElementById('sentenceCount').textContent = sentenceCount;
                document.getElementById('charCount').textContent = charCount;

                try {
                    const response = await fetch(`${API_BASE_URL}/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text }),
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // Populate Sentiment
                    const sentimentLabel = document.getElementById('sentimentLabel');
                    sentimentLabel.textContent = data.sentiment || '-';
                    sentimentLabel.classList.remove('text-green-400', 'text-red-400', 'text-yellow-400', 'text-white');
                    if (data.sentiment === 'Positive') {
                        sentimentLabel.classList.add('text-green-400');
                    } else if (data.sentiment === 'Negative') {
                        sentimentLabel.classList.add('text-red-400');
                    } else if (data.sentiment === 'Neutral') {
                        sentimentLabel.classList.add('text-yellow-400');
                    } else {
                        sentimentLabel.classList.add('text-white');
                    }

                    // Populate Keywords
                    const keywordsList = document.getElementById('keywordsList');
                    keywordsList.innerHTML = '';
                    if (data.keywords && data.keywords.length > 0) {
                        data.keywords.forEach(keyword => {
                            const badge = document.createElement('span');
                            badge.className = 'bg-gray-600 text-blue-200 text-sm font-medium px-3 py-1 rounded-full';
                            badge.textContent = keyword;
                            keywordsList.appendChild(badge);
                        });
                    } else {
                        keywordsList.innerHTML = '<p class="text-gray-400">No keywords found.</p>';
                    }

                    // Populate NER
                    const nerList = document.getElementById('nerList');
                    nerList.innerHTML = '';
                    if (data.entities && data.entities.length > 0) {
                        data.entities.forEach(entity => {
                            const item = document.createElement('div');
                            item.className = 'flex justify-between items-center bg-gray-700 px-3 py-2 rounded';
                            
                            const text = document.createElement('span');
                            text.className = 'text-gray-200 truncate pr-2';
                            text.textContent = entity.text;
                            
                            const type = document.createElement('span');
                            type.className = 'text-xs uppercase font-semibold text-purple-300 bg-purple-800 bg-opacity-50 px-2 py-0.5 rounded flex-shrink-0';
                            type.textContent = entity.type;

                            item.appendChild(text);
                            item.appendChild(type);
                            nerList.appendChild(item);
                        });
                    } else {
                        nerList.innerHTML = '<p class="text-gray-400">No entities found.</p>';
                    }

                } catch (error) {
                    showError(`Failed to analyze text: ${error.message}`);
                    document.getElementById('sentimentLabel').textContent = '-';
                    document.getElementById('keywordsList').innerHTML = '<p class="text-gray-400">Analysis failed.</p>';
                    document.getElementById('nerList').innerHTML = '<p class="text-gray-400">Analysis failed.</p>';
                } finally {
                    hideLoader('analysisLoader', 'analysisContent');
                }
            }

            /**
             * 2. Handle Summarization
             */
            async function handleSummarize() {
                const text = getText();
                if (!text) return;

                switchTab('summary');
                showLoader('summaryLoader', 'summaryContent');
                const summaryContent = document.getElementById('summaryContent');
                summaryContent.innerHTML = '';

                try {
                    const response = await fetch(`${API_BASE_URL}/summarize`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text }),
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    summaryContent.textContent = data.summary;

                } catch (error) {
                    showError(`Failed to generate summary: ${error.message}`);
                    summaryContent.innerHTML = '<p class="text-red-400">Failed to generate summary.</p>';
                } finally {
                    hideLoader('summaryLoader', 'summaryContent');
                }
            }
            
            /**
             * 3. Handle Q&A
             */
            async function handleAsk() {
                const text = getText();
                if (!text) return;

                const question = questionInput.value.trim();
                if (!question) {
                    showError('Please enter a question to ask.');
                    return;
                }

                showLoader('qaLoader', 'qaContent');
                const qaContent = document.getElementById('qaContent');
                qaContent.innerHTML = '';

                try {
                    const response = await fetch(`${API_BASE_URL}/ask`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text, question }),
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    qaContent.textContent = data.answer;
                    
                } catch (error) {
                    showError(`Failed to get answer: ${error.message}`);
                    qaContent.innerHTML = '<p class="text-red-400">Failed to get an answer.</p>';
                } finally {
                    hideLoader('qaLoader', 'qaContent');
                }
            }

            /**
             * 4. Handle Generate Reply
             */
            async function handleGenerateReply() {
                const text = getText();
                if (!text) return;
                
                switchTab('generate');
                showLoader('generateLoader', 'generateContent');
                const generateContent = document.getElementById('generateContent');
                generateContent.value = '';

                try {
                    const response = await fetch(`${API_BASE_URL}/generate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            text,
                            prompt: "Based on the provided text, draft a professional and concise reply."
                        }),
                    });

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    generateContent.value = data.generated_text;
                    
                } catch (error) {
                    showError(`Failed to generate reply: ${error.message}`);
                    generateContent.value = 'Failed to generate a reply.';
                } finally {
                    hideLoader('generateLoader', 'generateContent');
                }
            }

            // --- Attach Event Listeners ---
            
            if (fileUpload) {
                fileUpload.addEventListener('change', handleFileUpload);
            } else {
                console.error("Error: fileUpload element not found.");
            }

            if (analyzeButton) {
                analyzeButton.addEventListener('click', handleAnalyze);
            } else {
                console.error("Error: analyzeButton element not found.");
            }

            if (summarizeButton) {
                summarizeButton.addEventListener('click', handleSummarize);
            } else {
                console.error("Error: summarizeButton element not found.");
            }
            
            if (askButton) {
                askButton.addEventListener('click', handleAsk);
            } else {
                console.error("Error: askButton element not found.");
            }
            
            if (replyButton) {
                replyButton.addEventListener('click', handleGenerateReply);
            } else {
                console.error("Error: replyButton element not found.");
            }

            if (closeErrorModal) {
                 closeErrorModal.addEventListener('click', () => {
                    if (errorModal) errorModal.classList.add('hidden');
                });
            } else {
                console.error("Error: closeErrorModal element not found.");
            }

            if (tabButtons && tabButtons.length > 0) {
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        switchTab(button.dataset.tab);
                    });
                });
            } else {
                console.error("Error: tabButtons not found.");
            }

        }); // End of window.addEventListener('load')
    </script>
</body>
</html>

